{% extends "base.html" %}
{% block title %} Recepies {% endblock %}

{% block head %}
{{super()}}
{% endblock %}


{% block content %}
<div class="d-flex flex-row mb-2">
    <nav class="col-12 topbar" role="navigation" id="shopMenu">
        <ul class="nav nav-pills">
            <li class="nav-item"><a class="btn btn-outline-primary" style="color:#0275d8" href="{{ url_for('shopapp.shop_main') }}" ><i class="fa fa-arrow-left" aria-hidden="true"></i></a></li>

                <h5 class="align-self-center my-0 mx-5" style="font-size:150%">{{ prods[0].category.name }}</h5>
        </ul>
    </nav>
</div>

<div class="container-fluid">
    <ul id="lists" class="list-group">
        {% for prod in prods %}
        <li class="list-group-item p-0 border-left-0 border-right-0">
            <div class="d-flex w-100 justify-content-end">
                <div class="col">{{ prod.name }}</div>
                <div class="d-flex flex-row">
                    <button class="btn btn-link ml-auto h-50" href="#"><i class="fa fa-edit fa-lg"></i></button>
                    <button id="delProduct" data-url="{{ url_for('shopapp.delProduct', prod_id = prod.id) }}" class="btn btn-link mx-2 h-50 delProduct"><i class="fa fa-trash fa-lg"></i></button>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
    <div class="d-flex justify-content-between">
        <button class="btn btn-outline-primary my-2" style="border-radius:20px" data-toggle="modal" data-target="#newItem">+New Item</button>
    </div>        

</div>

{% from 'macros.html' import make_modal %}
{% call make_modal('newItem', 'Create new product', '/new-product', 'newProdForm')%}
{{ prodForm.csrf_token }}
<div class="d-flex flex-inline">
    <div class="form-group col-6">
        <small class="my-0 py-0">{{ prodForm.name.label(class='my-0') }}</small>
        {{ prodForm.name(required='required') }}
        {% for error in prodForm.errors.name %}
        <span style="color: red;">[{{error}}]</span>
        {% endfor %}
    </div>            
    <div class="form-group col-6">
        <small class="my-0 py-0">{{ prodForm.category.label(class='my-0') }}</small>
        {{ prodForm.category }}
    </div>
</div>        
<div class="d-flex flex-inline">
    <div class="form-group col-6">
        <small class="my-0 py-0">{{ prodForm.size.label(class='my-0') }}</small>
        {{ prodForm.size(type="number") }}
    </div>
    <div class="form-group col-4">
        <small class="my-0 py-0">{{ prodForm.unit.label(class='my-0') }}</small>
        {{ prodForm.unit }}
    </div>
</div>
<div class="form-group mx-3">
    <small class="my-0 py-0">{{ prodForm.note.label(class='my-0') }}</small>
    {{ prodForm.note }}
</div>

{% endcall %}



<script>
    var $SCRIPT_ROOT={{ request.script_root|tojson|safe }};
    $(document).ready(function(){
        $('.modal')
            .on({
            'show.bs.modal':function(){
                var idx = $('.modal:visible').length;
                $(this).css('z-index', 1040 + (5*idx));
            },

            'shown.bs.modal':function(){
                var idx=($('.modal:visible').length) - 1;
                $('.modal-backdrop').not('.stacked')
                    .css('z-index',1039 + (5*idx))
                    .addClass('stacked');
            },

            'hidden.bs.modal':function(){
                if($('.modal:visible').length > 0){
                    setTimeout(function(){
                        $(document.body).addClass('modal-open');
                    },0);
                }
            }

        });

        $('.delProduct').on('click',function(){
            if(confirm('Do you want to delete item?')){
                $.post($(this).attr("data-url"));
                setTimeout(function() {
                    window.location.reload();
                },0);                

            }
        });
    });
</script>
{% endblock %}
